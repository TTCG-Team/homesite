import{L as w,P as v,T as R}from"./PopupWindow.astro_astro_type_script_index_0_lang.24cxTJvV.js";const f=new Date(0);function b(a){let i=Date.now()>=f.getTime();a(i),setInterval(()=>{let e=Date.now()>=f.getTime();e!==i&&(a(e),i=e)},1e3)}class L{version;initialised;now;epoch;countdownEnded;hasEndedCallback;element;rotors;rotorLeafFront;rotorLeafRear;rotorTops;rotorBottoms;countdown;daysRemaining;clockValues;clockStrings;clockValuesAsString;prevClockValuesAsString;opts;constructor(t,i,s={}){if(typeof t!="number")throw new Error(`FlipDown: Constructor expected unix timestamp, got ${typeof t} instead.`);this.version="0.3.2",this.initialised=!1,this.now=this._getTime(),this.epoch=t,this.countdownEnded=!1,this.hasEndedCallback=null,typeof i=="string"?this.element=document.querySelector(i):this.element=i,this.rotors=[],this.rotorLeafFront=[],this.rotorLeafRear=[],this.rotorTops=[],this.rotorBottoms=[],this.countdown=null,this.daysRemaining=0,this.clockValues={},this.clockStrings={},this.clockValuesAsString=[],this.prevClockValuesAsString=[],this.opts=this._parseOptions(s),this._setOptions()}start(){return this.initialised||this._init(),this.countdown=setInterval(this._tick.bind(this),1e3),this}ifEnded(t){return this.hasEndedCallback=function(){t(),this.hasEndedCallback=null},this}_getTime(){return new Date().getTime()/1e3}_hasCountdownEnded(){return this.epoch-this.now<0?(this.countdownEnded=!0,this.hasEndedCallback!=null&&(this.hasEndedCallback(),this.hasEndedCallback=null),!0):(this.countdownEnded=!1,!1)}_parseOptions(t){let i=["Days","Hours","Minutes","Seconds"];return t.headings&&t.headings.length===4&&(i=t.headings),{theme:t.hasOwnProperty("theme")?t.theme:"dark",headings:i}}_setOptions(){this.element.classList.add(`flipdown__theme-${this.opts.theme}`)}_init(){let t;this.initialised=!0,this._hasCountdownEnded()?this.daysRemaining=0:this.daysRemaining=Math.floor((this.epoch-this.now)/86400).toString().length;var i=this.daysRemaining<=2?2:this.daysRemaining;for(t=0;t<i+6;t++)this.rotors.push(this._createRotor(0));const s=[];for(t=0;t<i;t++)s.push(this.rotors[t]);this.element.appendChild(this._createRotorGroup(s,0));let e=i;for(t=0;t<3;t++){for(var r=[],o=0;o<2;o++)r.push(this.rotors[e]),e++;this.element.appendChild(this._createRotorGroup(r,t+1))}return this.rotorLeafFront=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-leaf-front")),this.rotorLeafRear=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-leaf-rear")),this.rotorTops=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-top")),this.rotorBottoms=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-bottom")),this._tick(),this._updateClockValues(!0),this}_createRotorGroup(t,i){var s=document.createElement("div");s.className="rotor-group";var e=document.createElement("div");return e.className="rotor-group-heading",e.setAttribute("data-before",this.opts.headings[i]),s.appendChild(e),m(s,t),s}_createRotor(t=0){const i=document.createElement("div"),s=document.createElement("div"),e=document.createElement("figure"),r=document.createElement("figure"),o=document.createElement("div"),h=document.createElement("div");return i.className="rotor",s.className="rotor-leaf",e.className="rotor-leaf-rear",r.className="rotor-leaf-front",o.className="rotor-top",h.className="rotor-bottom",e.textContent=t.toString(),o.textContent=t.toString(),h.textContent=t.toString(),m(i,[s,o,h]),m(s,[e,r]),i}_tick(){this.now=this._getTime();var t=this.epoch-this.now<=0?0:this.epoch-this.now;this.clockValues.d=Math.floor(t/86400),t-=this.clockValues.d*86400,this.clockValues.h=Math.floor(t/3600),t-=this.clockValues.h*3600,this.clockValues.m=Math.floor(t/60),t-=this.clockValues.m*60,this.clockValues.s=Math.floor(t),this._updateClockValues(),this._hasCountdownEnded()}_updateClockValues(t=!1){this.clockStrings.d=g(this.clockValues.d,2),this.clockStrings.h=g(this.clockValues.h,2),this.clockStrings.m=g(this.clockValues.m,2),this.clockStrings.s=g(this.clockValues.s,2),this.clockValuesAsString=(this.clockStrings.d+this.clockStrings.h+this.clockStrings.m+this.clockStrings.s).split(""),this.rotorLeafFront.forEach((e,r)=>{e.textContent=this.prevClockValuesAsString[r]}),this.rotorBottoms.forEach((e,r)=>{e.textContent=this.prevClockValuesAsString[r]});const i=()=>{this.rotorTops.forEach((e,r)=>{e.textContent!=this.clockValuesAsString[r]&&(e.textContent=this.clockValuesAsString[r])})},s=()=>{this.rotorLeafRear.forEach((e,r)=>{if(e.textContent!=this.clockValuesAsString[r]){e.textContent=this.clockValuesAsString[r],e.parentElement.classList.add("flipped");const o=setInterval(function(){e.parentElement.classList.remove("flipped"),clearInterval(o)}.bind(this),500)}})};t?(i(),s()):(setTimeout(i,500),setTimeout(s,500)),this.prevClockValuesAsString=this.clockValuesAsString}}function g(a,t){return a=a.toString(),a.length<t?g("0"+a,t):a}function m(a,t){t.forEach(i=>{a.appendChild(i)})}class A{element;constructor(t){this.element=t}get value(){return this.element.getBoundingClientRect().width}}class S{container;canvasRef;gl;renderLoop=null;shaderProgram=null;uResolutionLocation;uProgressLocation;transitionFinished=!1;transitionActive=!1;transitionTick=1e3;transitionProgress=0;frag=`
        precision mediump float;
        varying vec2 v_texCoord;
        uniform sampler2D u_tex;
        uniform sampler2D u_image0;
        uniform sampler2D u_image1;
        uniform sampler2D u_imageDisplace;
        
        uniform float u_progress;

        void main() {
            float displacement=texture2D(u_imageDisplace, v_texCoord).r * 0.3;
            vec2 uvFromDist=vec2(v_texCoord.x+u_progress*displacement, v_texCoord.y);
            vec2 uvToDist=vec2(v_texCoord.x-(1.0-u_progress)*displacement, v_texCoord.y);
            vec4 colorFrom = texture2D(u_image0, uvFromDist);
            vec4 colorTo = texture2D(u_image1, uvToDist);
            gl_FragColor = mix(colorFrom, colorTo, u_progress);
        }
    
    `;vert=`
        precision mediump float;
        attribute vec4 a_position;
        uniform mat4 u_matrix;
        varying vec2 v_texCoord;

        void main() {
            gl_Position = u_matrix * a_position;
            v_texCoord=a_position.xy* .5 + .5;
        }
    `;promise;constructor(t,i,s,e={}){if(!t)throw new TypeError("valid container element needs to be provided");if(this.container=t,!s)throw new TypeError("displacement image is required");let r=e.duration||1200;const o=1e3/60;this.transitionTick=1/r*o,this.promise=this.create(i,s)}loadImages(t){return new Promise((i,s)=>{let e=0,r=[];t.forEach((o,h)=>{let l;if(typeof o=="string")l=new Image,l.src=o;else if(o instanceof HTMLImageElement)l=o;else return s("could not load image: "+o);l.complete?(r[h]=l,e++):(l.onload=()=>{r[h]=l,e++,e===t.length&&i(r)},l.onerror=()=>s("could not load image: "+l.src)),e===t.length&&i(r)})})}setCanvasDim(){this.canvasRef.width=this.container.clientWidth,this.canvasRef.height=this.container.clientHeight}createGlContext(t){const i=document.createElement("canvas");if(this.canvasRef=i,this.canvasRef.style.height="100%",this.canvasRef.style.width="100%",this.canvasRef.style.display="block",this.gl=this.canvasRef.getContext("webgl"),!this.gl)throw new TypeError("could not find a valid WebGL Rendering Context");t.innerHTML="",t.appendChild(i)}async create(t,i){try{this.createGlContext(this.container),this.setCanvasDim(),this.shaderProgram=this.createShaderProgram(this.gl,this.vert,this.frag),this.uImage0Location=this.gl.getUniformLocation(this.shaderProgram,"u_image0"),this.uImage1Location=this.gl.getUniformLocation(this.shaderProgram,"u_image1"),this.uImageDisplaceLocation=this.gl.getUniformLocation(this.shaderProgram,"u_imageDisplace");const s=[...t,i],e=await this.loadImages(s),r=e.pop(),o=e;this.createRenderer(o,r)}catch(s){console.dir(s)}}uImage0Location;uImage1Location;uImageDisplaceLocation;createRenderer(t,i){if(!this.gl||!this.shaderProgram)throw new Error("failed");if(t.length<2)throw new Error("at least 2 images are required");let s=this.gl.getAttribLocation(this.shaderProgram,"a_position"),e=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e);const r=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.STATIC_DRAW),this.gl.useProgram(this.shaderProgram);const o=[];let h=null;for(let n=0;n<t.length+1;++n){const c=this.gl.createTexture();if(!c)throw new Error("failed to create texture");if(this.gl.bindTexture(this.gl.TEXTURE_2D,c),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),n===t.length){this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i),h=c;continue}this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t[n]),o.push(c)}this.uResolutionLocation=this.gl.getUniformLocation(this.shaderProgram,"u_resolution"),this.uProgressLocation=this.gl.getUniformLocation(this.shaderProgram,"u_progress");const l=this.gl.getUniformLocation(this.shaderProgram,"u_matrix"),p=()=>{const n=t[0];if(!n)throw new TypeError("failed to get image");const c=this.canvasRef.clientWidth/this.canvasRef.clientHeight;let d=n.width/n.height/c,E=1;d<1&&(E=1/d,d=1),this.gl.uniformMatrix4fv(l,!1,new Float32Array([d,0,0,0,0,-E,0,0,0,0,1,0,0,0,0,1]))};this.gl.uniform2fv(this.uResolutionLocation,[this.canvasRef.clientWidth,this.canvasRef.clientHeight]),this.gl.uniform1f(this.uProgressLocation,0),p();let u=t.length;for(let n=0;n<u;++n)this.gl.activeTexture(this.gl.TEXTURE0+n),this.gl.bindTexture(this.gl.TEXTURE_2D,o[n]);this.gl.activeTexture(this.gl.TEXTURE0+u),this.gl.bindTexture(this.gl.TEXTURE_2D,h),this.gl.uniform1i(this.uImage0Location,0),this.gl.uniform1i(this.uImage1Location,0),this.gl.uniform1i(this.uImageDisplaceLocation,u),this.gl.enableVertexAttribArray(s),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e);let T=2,_=this.gl.FLOAT;this.gl.vertexAttribPointer(s,T,_,!1,0,0),this.gl.viewport(0,0,this.canvasRef.width,this.canvasRef.height),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6),new w(new A(this.canvasRef)).addListener("change",()=>{this.gl&&(this.setCanvasDim(),p(),this.gl.uniform2fv(this.uResolutionLocation,[this.canvasRef.clientWidth,this.canvasRef.clientHeight]),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.drawArrays(this.gl.TRIANGLES,0,6))})}render(){this.gl.uniform1f(this.uProgressLocation,this.transitionProgress),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}start(){this.transitionActive=!0,this.renderLoop&&cancelAnimationFrame(this.renderLoop),this.transitionForwards()}reverse(){this.transitionActive=!0,this.renderLoop&&cancelAnimationFrame(this.renderLoop),this.transitionBackwards()}transitionForwards(){this.transitionProgress<=1?(this.transitionProgress+=this.transitionTick,this.render(),this.renderLoop=requestAnimationFrame(()=>this.transitionForwards())):(this.transitionProgress=1,this.render(),this.transitionActive=!1,this.transitionFinished=!0)}transitionBackwards(){this.transitionProgress>=0?(this.transitionProgress-=this.transitionTick,this.render(),this.renderLoop=requestAnimationFrame(()=>this.transitionBackwards())):(this.transitionProgress=0,this.render(),this.transitionActive=!1,this.transitionFinished=!1)}setImage(t,i){this.gl.uniform1i(this.uImage0Location,t),this.gl.uniform1i(this.uImage1Location,i)}set progress(t){this.transitionProgress!==t&&(this.transitionProgress=t,this.gl.uniform1f(this.uProgressLocation,this.transitionProgress))}get progress(){return this.transitionProgress}draw(){this.gl.drawArrays(this.gl.TRIANGLES,0,6)}destroy(){this.gl&&(this.renderLoop&&cancelAnimationFrame(this.renderLoop),this.gl.deleteProgram(this.shaderProgram))}createShaderProgram(t,i,s){const e=this.createShader(t,t.VERTEX_SHADER,i),r=this.createShader(t,t.FRAGMENT_SHADER,s);return this.createProgram(t,e,r)}createShader(t,i,s){const e=t.createShader(i);if(!e)throw"could not create shader";if(t.shaderSource(e,s),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))return e;const o=t.getShaderInfoLog(e);throw t.deleteShader(e),`could not compile shader: ${o}`}createProgram(t,i,s){const e=t.createProgram();if(!e)throw"could not create program";if(t.attachShader(e,i),t.attachShader(e,s),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS))return e;const o=t.getProgramInfoLog(e);throw t.deleteProgram(e),`could not compile shader: ${o}`}}let C=f.getTime()/1e3;new L(C,"#countdown").start();let k=document.querySelectorAll(".count-down-frame");for(let a of k){let t=a.querySelector(".info-button"),i=a.querySelector(".popup-window");t.addEventListener("click",()=>{v.get(i).show()});let s=a.querySelector(".transition"),e=new S(s,["/imgs/elements/obsidian_bg.jpg","/imgs/elements/obsidian_bg2.jpg","/imgs/elements/obsidian_bg3.jpg"],"/imgs/elements/dis.png",{duration:1200}),r=0,o;setInterval(()=>{let h=(r+1)%3;e.setImage(r,h),r=h,e.progress=0,e.draw(),o?.stop(),o=new R(e).to({progress:1},900).onUpdate(()=>{e.draw()}).start()},1e4)}export{S as T,b as c};
