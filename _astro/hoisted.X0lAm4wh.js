import"./NavBar.astro_astro_type_script_index_0_lang.C-Wt8aoR.js";import"https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.10.2/umd/popper.min.js";import{T as L,L as y}from"./listener.CQnL6xw7.js";import"./_commonjsHelpers.BosuxZz1.js";let _=!1;function E(r){let t=window.scrollY,i=Math.ceil(t/window.innerHeight);window.scrollTo(0,window.innerHeight*(i+r)),_=!0,setTimeout(()=>{_=!1},600)}window.addEventListener("wheel",r=>{if(!_){let t=0;r.deltaY<0?t=-1:r.deltaY>0&&(t=1),E(t)}r.stopImmediatePropagation()});let f,R;window.addEventListener("touchstart",r=>{f=r.touches[0],R=Date.now()});const w=r=>{f=null};window.addEventListener("touchcancel",w);window.addEventListener("touchend",w);window.addEventListener("touchmove",r=>{if(Date.now()-R>400)return;let t;if(f){for(let i of r.touches)if(i.identifier===f.identifier){t=i;break}}if(t){let i=t.pageY-f.pageY;i>100?(E(-1),w()):i<-100&&(E(1),w())}});class d{static _percent=.5;static set percent(t){this._percent!==t&&(this._percent=t,d.updateAll())}static get percent(){return this._percent}static _tween;static animatePercent(t){this._tween?.stop(),this._tween=new L(this).to({percent:t},900).start()}static views=[];element;left;right;constructor(t){this.element=t;let i=t.children;for(let s of i)s.nodeName.toLowerCase()==="div"&&(this.left?this.right||(this.right=s):this.left=s);this.right.style.flexGrow="1",d.views.push(this),this._update()}_update(){let t=this.element.getBoundingClientRect();this.left.style.width=`${t.width*d.percent}px`,this.right.style.maxWidth=`${t.width*(1-d.percent)}px`}static updateAll(){for(let t of d.views)t._update()}}window.addEventListener("resize",()=>{d.updateAll()});let m=[],S=()=>{let r,t,i=null;for(let s=0,e=m.length;s<e;++s){let o=m[s];o.onscroll();let n=Math.abs(o.offset);(i===null||i>n)&&(i=n,r=o,o.offset>0&&s>=0?t=m[s-1]:o.offset<0?t=m[s+1]:t=null)}if(r){let s=Math.max(1-Math.abs(r.offset)/window.innerHeight,.01),e=r.percent;t&&(e=e*s+t.percent*(1-s)),d.animatePercent(e)}};document.addEventListener("scroll",S);class x{element;inner;_oldTime=0;_rect;_isShow=!1;percent=.5;offset;constructor(t){this.element=t,this.percent=parseFloat(t.dataset.percent),this.inner=t.querySelector(".fade-in-inner"),m.push(this),this.onscroll()}set isShow(t){this._isShow!==t&&(this._isShow=t,t?this.element.classList.add("display"):this.element.classList.remove("display"))}get isShow(){return this._isShow}onscroll(){this._testUpdate();let t=(this._rect.top+this._rect.bottom)/2;this.offset=window.innerHeight/2-t,this.inner.style.transform=`translate(0, ${-this.offset/4}px)`,this.element.style.opacity=`${Math.min(1,(1-Math.abs(this.offset/window.innerHeight))*1.4)}`}_testUpdate(){let t=Date.now(),i=this.element.getBoundingClientRect();this._rect=i,this._oldTime=t}}window.addEventListener("load",S);let A=document.querySelectorAll(".fade-in-item");for(let r of A)new x(r);let I=class{element;constructor(t){this.element=t}get value(){return this.element.getBoundingClientRect().width}};class B{container;canvasRef;gl;renderLoop=null;shaderProgram=null;uResolutionLocation;uProgressLocation;transitionFinished=!1;transitionActive=!1;transitionTick=1e3;transitionProgress=0;frag=`
        precision mediump float;
        varying vec2 v_texCoord;
        uniform sampler2D u_tex;
        uniform sampler2D u_image0;
        uniform sampler2D u_image1;
        uniform sampler2D u_imageDisplace;
        
        uniform float u_progress;

        void main() {
            float displacement=texture2D(u_imageDisplace, v_texCoord).r * 0.3;
            vec2 uvFromDist=vec2(v_texCoord.x+u_progress*displacement, v_texCoord.y);
            vec2 uvToDist=vec2(v_texCoord.x-(1.0-u_progress)*displacement, v_texCoord.y);
            vec4 colorFrom = texture2D(u_image0, uvFromDist);
            vec4 colorTo = texture2D(u_image1, uvToDist);
            gl_FragColor = mix(colorFrom, colorTo, u_progress);
        }
    
    `;vert=`
        precision mediump float;
        attribute vec4 a_position;
        uniform mat4 u_matrix;
        varying vec2 v_texCoord;

        void main() {
            gl_Position = u_matrix * a_position;
            v_texCoord=a_position.xy* .5 + .5;
        }
    `;constructor(t,i,s,e={}){if(!t)throw new TypeError("valid container element needs to be provided");if(this.container=t,!s)throw new TypeError("displacement image is required");let o=e.duration||1200;const n=1e3/60;this.transitionTick=1/o*n,this.create(i,s)}loadImages(t){return new Promise((i,s)=>{let e=0,o=[];t.forEach((n,l)=>{let a;if(typeof n=="string")a=new Image,a.src=n;else if(n instanceof HTMLImageElement)a=n;else return s("could not load image: "+n);a.complete?(o[l]=a,e++):(a.onload=()=>{o[l]=a,e++,e===t.length&&i(o)},a.onerror=()=>s("could not load image: "+a.src)),e===t.length&&i(o)})})}setCanvasDim(){this.canvasRef.width=this.container.clientWidth,this.canvasRef.height=this.container.clientHeight}createGlContext(t){const i=document.createElement("canvas");if(this.canvasRef=i,this.canvasRef.style.height="100%",this.canvasRef.style.width="100%",this.canvasRef.style.display="block",this.gl=this.canvasRef.getContext("webgl"),!this.gl)throw new TypeError("could not find a valid WebGL Rendering Context");t.innerHTML="",t.appendChild(i)}async create(t,i){try{this.createGlContext(this.container),this.setCanvasDim(),this.shaderProgram=this.createShaderProgram(this.gl,this.vert,this.frag),this.uImage0Location=this.gl.getUniformLocation(this.shaderProgram,"u_image0"),this.uImage1Location=this.gl.getUniformLocation(this.shaderProgram,"u_image1"),this.uImageDisplaceLocation=this.gl.getUniformLocation(this.shaderProgram,"u_imageDisplace");const s=[...t,i],e=await this.loadImages(s),o=e.pop(),n=e;this.createRenderer(n,o)}catch(s){console.dir(s)}}uImage0Location;uImage1Location;uImageDisplaceLocation;createRenderer(t,i){if(!this.gl||!this.shaderProgram)throw new Error("failed");if(t.length<2)throw new Error("at least 2 images are required");let s=this.gl.getAttribLocation(this.shaderProgram,"a_position"),e=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e);const o=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.STATIC_DRAW),this.gl.useProgram(this.shaderProgram);const n=[];let l=null;for(let h=0;h<t.length+1;++h){const g=this.gl.createTexture();if(!g)throw new Error("failed to create texture");if(this.gl.bindTexture(this.gl.TEXTURE_2D,g),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),h===t.length){this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i),l=g;continue}this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t[h]),n.push(g)}this.uResolutionLocation=this.gl.getUniformLocation(this.shaderProgram,"u_resolution"),this.uProgressLocation=this.gl.getUniformLocation(this.shaderProgram,"u_progress");const a=this.gl.getUniformLocation(this.shaderProgram,"u_matrix"),c=()=>{const h=t[0];if(!h)throw new TypeError("failed to get image");const g=this.canvasRef.clientWidth/this.canvasRef.clientHeight;let p=h.width/h.height/g,T=1;p<1&&(T=1/p,p=1),this.gl.uniformMatrix4fv(a,!1,new Float32Array([p,0,0,0,0,-T,0,0,0,0,1,0,0,0,0,1]))};this.gl.uniform2fv(this.uResolutionLocation,[this.canvasRef.clientWidth,this.canvasRef.clientHeight]),this.gl.uniform1f(this.uProgressLocation,0),c();let u=t.length;for(let h=0;h<u;++h)this.gl.activeTexture(this.gl.TEXTURE0+h),this.gl.bindTexture(this.gl.TEXTURE_2D,n[h]);this.gl.activeTexture(this.gl.TEXTURE0+u),this.gl.bindTexture(this.gl.TEXTURE_2D,l),this.gl.uniform1i(this.uImage0Location,0),this.gl.uniform1i(this.uImage1Location,0),this.gl.uniform1i(this.uImageDisplaceLocation,u),this.gl.enableVertexAttribArray(s),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e);let v=2,P=this.gl.FLOAT;this.gl.vertexAttribPointer(s,v,P,!1,0,0),this.gl.viewport(0,0,this.canvasRef.width,this.canvasRef.height),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6),new y(new I(this.canvasRef)).addListener("change",()=>{this.gl&&(this.setCanvasDim(),c(),this.gl.uniform2fv(this.uResolutionLocation,[this.canvasRef.clientWidth,this.canvasRef.clientHeight]),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.drawArrays(this.gl.TRIANGLES,0,6))})}render(){this.gl.uniform1f(this.uProgressLocation,this.transitionProgress),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}start(){this.transitionActive=!0,this.renderLoop&&cancelAnimationFrame(this.renderLoop),this.transitionForwards()}reverse(){this.transitionActive=!0,this.renderLoop&&cancelAnimationFrame(this.renderLoop),this.transitionBackwards()}transitionForwards(){this.transitionProgress<=1?(this.transitionProgress+=this.transitionTick,this.render(),this.renderLoop=requestAnimationFrame(()=>this.transitionForwards())):(this.transitionProgress=1,this.render(),this.transitionActive=!1,this.transitionFinished=!0)}transitionBackwards(){this.transitionProgress>=0?(this.transitionProgress-=this.transitionTick,this.render(),this.renderLoop=requestAnimationFrame(()=>this.transitionBackwards())):(this.transitionProgress=0,this.render(),this.transitionActive=!1,this.transitionFinished=!1)}setImage(t,i){this.gl.uniform1i(this.uImage0Location,t),this.gl.uniform1i(this.uImage1Location,i)}set progress(t){this.transitionProgress!==t&&(this.transitionProgress=t,this.gl.uniform1f(this.uProgressLocation,this.transitionProgress))}get progress(){return this.transitionProgress}draw(){this.gl.drawArrays(this.gl.TRIANGLES,0,6)}destroy(){this.gl&&(this.renderLoop&&cancelAnimationFrame(this.renderLoop),this.gl.deleteProgram(this.shaderProgram))}createShaderProgram(t,i,s){const e=this.createShader(t,t.VERTEX_SHADER,i),o=this.createShader(t,t.FRAGMENT_SHADER,s);return this.createProgram(t,e,o)}createShader(t,i,s){const e=t.createShader(i);if(!e)throw"could not create shader";if(t.shaderSource(e,s),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))return e;const n=t.getShaderInfoLog(e);throw t.deleteShader(e),`could not compile shader: ${n}`}createProgram(t,i,s){const e=t.createProgram();if(!e)throw"could not create program";if(t.attachShader(e,i),t.attachShader(e,s),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS))return e;const n=t.getProgramInfoLog(e);throw t.deleteProgram(e),`could not compile shader: ${n}`}}class D{element;canvas;details;dots;transition;indexElement;constructor(t){let i=t.parentElement;this.canvas=i.querySelector(".transition"),this.element=t,this.indexElement=t.querySelector(".control-index > div"),this.transition=new B(this.canvas,["/imgs/arts/pic_web_01.jpg","/imgs/arts/pic_web_02.jpg","/imgs/arts/pic_web_03.jpg"],"/imgs/summary/dis.jpg",{duration:1200}),this.details=[];for(let o of t.querySelectorAll(".summary-details"))this.details.push(o);this.dots=[];for(let o of i.querySelectorAll(".dots .dot"))this.dots.push(o);for(let o=0,n=this.dots.length;o<n;++o)this.dots[o].onclick=()=>{this.selected=o};t.querySelector(".control-arrow .left").addEventListener("click",()=>{let o=this.selected-1;o<0&&(o+=this.length),this.selected=o}),t.querySelector(".control-arrow .right").addEventListener("click",()=>{this.selected=(this.selected+1)%this.length}),this.selected=0}get length(){return this.details.length}_tween;_selected;set selected(t){if(this._selected!==t){typeof this._selected=="number"&&(this.dots[this._selected].classList.remove("selected"),this.details[this._selected].classList.remove("selected"));let i=this._selected||0;this.indexElement.innerText=`${t+1}/${this.length}`,this._selected=t,this.dots[t].classList.add("selected"),this.details[t].classList.add("selected"),this.setTimeout(),this.transition.setImage(i,t),this.transition.progress=0,this.transition.draw(),this._tween?.stop(),this._tween=new L(this.transition).to({progress:1},900).onUpdate(()=>{this.transition.draw()}).start()}}get selected(){return this._selected}_timeout;setTimeout(){clearTimeout(this._timeout)}}for(let r of document.querySelectorAll(".summary"))new D(r);class b{element;milestones;constructor(t){this.element=t,t.addEventListener("mousedown",this.touchstart.bind(this)),t.addEventListener("touchstart",this.touchstart.bind(this)),t.addEventListener("mousemove",this.touchmove.bind(this)),t.addEventListener("touchmove",this.touchmove.bind(this)),window.addEventListener("mouseup",this.touchend.bind(this)),t.addEventListener("touchend",this.touchend.bind(this)),t.addEventListener("touchcancel",this.touchend.bind(this)),this.milestones=[];let i=!0,s=0;for(let e of this.element.querySelectorAll(".milestone")){let o=e;this.milestones.push(o),i&&o.classList.add("done"),o.classList.contains("selected")&&(i=!1,s=o.offsetLeft+o.clientWidth/2-this.element.clientWidth/2,this.element.scrollTo({left:s}))}}_dragging=!1;_pointer={x:0,y:0};_oldX;makePointer(t){t instanceof MouseEvent?this._pointer={x:t.screenX,y:t.screenY}:t instanceof TouchEvent&&(this._pointer={x:t.touches[0].screenX,y:t.touches[0].screenY})}touchstart(t){this._dragging||(this._dragging=!0,this.makePointer(t),this._oldX=this.element.scrollLeft)}touchmove(t){if(this._dragging){let i=this._pointer.x;this.makePointer(t);let s=i-this._pointer.x;if(s>0){let e=this.element.scrollWidth-this.element.clientWidth;this._oldX<e&&(this._oldX+=s),this._oldX>e&&(this._oldX=e),console.log(this._oldX),this.element.scrollTo({left:this._oldX})}else s<0&&(this._oldX>0&&(this._oldX+=s),this._oldX<0&&(this._oldX=0),this.element.scrollTo({left:this._oldX}))}}touchend(t){this._dragging&&(this._dragging=!1)}}for(let r of document.querySelectorAll(".road-map > .map"))new b(r);let U=document.querySelectorAll(".split-view");for(let r of U)new d(r);class C{element;volumeIcon;mute;video;muteIcon;volumeUpIcon;_firstPlay=!1;constructor(t){this.element=t,this.volumeIcon=t.querySelector(".volume-icon"),this.mute=localStorage.getItem("video-mute")==="1",this.video=t.querySelector(".video video"),this.muteIcon=t.querySelector(".mute"),this.volumeUpIcon=t.querySelector(".volume-up"),this.volumeIcon.onclick=()=>{this.mute=!this.mute,localStorage.setItem("video-mute",`${this.mute?1:0}`),this._updateVolumeIcon()},this._updateVolumeIcon(),this.playVideo(),window.addEventListener("mousedown",()=>{this.playVideo()});let i=()=>{let s=t.getBoundingClientRect(),e=(s.top+s.bottom)/2,o=window.innerHeight,n=Math.min(o/2-Math.abs(o/2-e),0),l=Math.max(1+n/2048,0);this.video.volume=l};window.addEventListener("scroll",i),i()}_updateVolumeIcon(){this.mute?(this.video.muted=!0,this.muteIcon.style.display="block",this.volumeUpIcon.style.display="none"):(this.video.muted=!1,this.muteIcon.style.display="none",this.volumeUpIcon.style.display="block")}async playVideo(){if(!this._firstPlay)try{await this.video.play(),this._firstPlay=!0}catch{}}}for(let r of document.querySelectorAll(".cover-gap"))new C(r);class F{element;constructor(t){this.element=t}get value(){return this.element.getBoundingClientRect().height}}class X{element;scrollBar;constructor(t){this.element=t,this.scrollBar=t.querySelector(".scroll-bar"),t.addEventListener("wheel",l=>{let a=this.element.getBoundingClientRect();l.deltaY<0&&t.scrollTop<=0||l.deltaY>0&&t.scrollTop+a.height>=t.scrollHeight||(t.scrollTo(0,t.scrollTop+l.deltaY*5),this.updateScrollBar(),l.stopImmediatePropagation())}),new y(new F(t)).addListener("change",(l,a)=>{this.updateScrollBar()}),this.updateScrollBar();let s=!1,e=0;this.scrollBar.addEventListener("mousedown",l=>{s=!0,e=l.pageY}),window.addEventListener("mousemove",l=>{if(s){let a=l.pageY-e;e=l.pageY;let c=this.element.getBoundingClientRect(),u=c.height/this.element.scrollHeight,v=c.height*(1-u);this.element.scrollBy(0,(this.element.scrollHeight-c.height)*a/v),this.updateScrollBar()}}),window.addEventListener("mouseup",()=>{s=!1});let o;this.element.addEventListener("touchstart",l=>{o=l.touches[0]});let n=l=>{o=null};this.element.addEventListener("touchcancel",n),this.element.addEventListener("touchend",n),this.element.addEventListener("touchmove",l=>{let a;if(o){for(let c of l.touches)if(c.identifier===o.identifier){a=c;break}}if(a){let c=a.pageY-o.pageY;this.element.scrollBy(0,-c),this.updateScrollBar(),o=a,l.stopImmediatePropagation()}})}updateScrollBar(){let t=this.element.getBoundingClientRect(),i=t.height/this.element.scrollHeight,s=t.height*i,e=this.element.scrollTop;if(i>=1)this.scrollBar.style.display="none";else{this.scrollBar.style.display="block";let o=t.height-s;this.scrollBar.style.height=`${s}px`;let n=e/(this.element.scrollHeight-t.height);this.scrollBar.style.top=`${o*n+e-5}px`}}}let q=document.querySelectorAll(".scroll-view");for(let r of q)new X(r);
