import"./NavBar.astro_astro_type_script_index_0_lang.C-Wt8aoR.js";import"https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.min.js";import"https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.10.2/umd/popper.min.js";import{T as v,L as E}from"./listener.CQnL6xw7.js";import"./_commonjsHelpers.BosuxZz1.js";let f=!1;window.addEventListener("wheel",o=>{if(!f){let t=window.scrollY,s=Math.ceil(t/window.innerHeight),e=0;o.deltaY<0?e=-1:o.deltaY>0&&(e=1),window.scrollTo(0,window.innerHeight*(s+e)),f=!0,setTimeout(()=>{f=!1},600)}o.stopImmediatePropagation()});class h{static _percent=.5;static set percent(t){this._percent!==t&&(this._percent=t,h.updateAll())}static get percent(){return this._percent}static _tween;static animatePercent(t){this._tween?.stop(),this._tween=new v(this).to({percent:t},900).start()}static views=[];element;left;right;constructor(t){this.element=t;let s=t.children;for(let e of s)e.nodeName.toLowerCase()==="div"&&(this.left?this.right||(this.right=e):this.left=e);this.right.style.flexGrow="1",h.views.push(this),this._update()}_update(){let t=this.element.getBoundingClientRect();this.left.style.width=`${t.width*h.percent}px`,this.right.style.maxWidth=`${t.width*(1-h.percent)}px`}static updateAll(){for(let t of h.views)t._update()}}window.addEventListener("resize",()=>{h.updateAll()});let m=[];document.addEventListener("scroll",()=>{let o,t,s=null;for(let e=0,i=m.length;e<i;++e){let r=m[e];r.onscroll();let n=Math.abs(r.offset);(s===null||s>n)&&(s=n,o=r,r.offset>0&&e>=0?t=m[e-1]:r.offset<0?t=m[e+1]:t=null)}if(o){let e=Math.max(1-Math.abs(o.offset)/window.innerHeight,.01),i=o.percent;t&&(i=i*e+t.percent*(1-e)),h.animatePercent(i)}});class L{element;inner;_oldTime=0;_rect;_isShow=!1;percent=.5;offset;constructor(t){this.element=t,this.percent=parseFloat(t.dataset.percent),this.inner=t.querySelector(".fade-in-inner"),m.push(this),this.onscroll()}set isShow(t){this._isShow!==t&&(this._isShow=t,t?this.element.classList.add("display"):this.element.classList.remove("display"))}get isShow(){return this._isShow}onscroll(){this._testUpdate();let t=(this._rect.top+this._rect.bottom)/2;this.offset=window.innerHeight/2-t,this.inner.style.transform=`translate(0, ${-this.offset/4}px)`,this.element.style.opacity=`${Math.min(1,(1-Math.abs(this.offset/window.innerHeight))*1.4)}`}_testUpdate(){let t=Date.now(),s=this.element.getBoundingClientRect();this._rect=s,this._oldTime=t}}let y=document.querySelectorAll(".fade-in-item");for(let o of y)new L(o);class R{element;constructor(t){this.element=t}get value(){return this.element.getBoundingClientRect().width}}class P{container;canvasRef;gl;renderLoop=null;shaderProgram=null;uResolutionLocation;uProgressLocation;transitionFinished=!1;transitionActive=!1;transitionTick=1e3;transitionProgress=0;frag=`
        precision mediump float;
        varying vec2 v_texCoord;
        uniform sampler2D u_tex;
        uniform sampler2D u_image0;
        uniform sampler2D u_image1;
        uniform sampler2D u_imageDisplace;
        
        uniform float u_progress;

        void main() {
            float displacement=texture2D(u_imageDisplace, v_texCoord).r * 0.3;
            vec2 uvFromDist=vec2(v_texCoord.x+u_progress*displacement, v_texCoord.y);
            vec2 uvToDist=vec2(v_texCoord.x-(1.0-u_progress)*displacement, v_texCoord.y);
            vec4 colorFrom = texture2D(u_image0, uvFromDist);
            vec4 colorTo = texture2D(u_image1, uvToDist);
            gl_FragColor = mix(colorFrom, colorTo, u_progress);
        }
    
    `;vert=`
        precision mediump float;
        attribute vec4 a_position;
        uniform mat4 u_matrix;
        varying vec2 v_texCoord;

        void main() {
            gl_Position = u_matrix * a_position;
            v_texCoord=a_position.xy* .5 + .5;
        }
    `;constructor(t,s,e,i={}){if(!t)throw new TypeError("valid container element needs to be provided");if(this.container=t,!e)throw new TypeError("displacement image is required");let r=i.duration||1200;const n=1e3/60;this.transitionTick=1/r*n,this.create(s,e)}loadImages(t){return new Promise((s,e)=>{let i=0,r=[];t.forEach((n,c)=>{let l;if(typeof n=="string")l=new Image,l.src=n;else if(n instanceof HTMLImageElement)l=n;else return e("could not load image: "+n);l.complete?(r[c]=l,i++):(l.onload=()=>{r[c]=l,i++,i===t.length&&s(r)},l.onerror=()=>e("could not load image: "+l.src)),i===t.length&&s(r)})})}setCanvasDim(){this.canvasRef.width=this.container.clientWidth,this.canvasRef.height=this.container.clientHeight}createGlContext(t){const s=document.createElement("canvas");if(this.canvasRef=s,this.canvasRef.style.height="100%",this.canvasRef.style.width="100%",this.canvasRef.style.display="block",this.gl=this.canvasRef.getContext("webgl"),!this.gl)throw new TypeError("could not find a valid WebGL Rendering Context");t.innerHTML="",t.appendChild(s)}async create(t,s){try{this.createGlContext(this.container),this.setCanvasDim(),this.shaderProgram=this.createShaderProgram(this.gl,this.vert,this.frag),this.uImage0Location=this.gl.getUniformLocation(this.shaderProgram,"u_image0"),this.uImage1Location=this.gl.getUniformLocation(this.shaderProgram,"u_image1"),this.uImageDisplaceLocation=this.gl.getUniformLocation(this.shaderProgram,"u_imageDisplace");const e=[...t,s],i=await this.loadImages(e),r=i.pop(),n=i;this.createRenderer(n,r)}catch(e){console.dir(e)}}uImage0Location;uImage1Location;uImageDisplaceLocation;createRenderer(t,s){if(!this.gl||!this.shaderProgram)throw new Error("failed");if(t.length<2)throw new Error("at least 2 images are required");let e=this.gl.getAttribLocation(this.shaderProgram,"a_position"),i=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,i);const r=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.STATIC_DRAW),this.gl.useProgram(this.shaderProgram);const n=[];let c=null;for(let a=0;a<t.length+1;++a){const d=this.gl.createTexture();if(!d)throw new Error("failed to create texture");if(this.gl.bindTexture(this.gl.TEXTURE_2D,d),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),a===t.length){this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,s),c=d;continue}this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t[a]),n.push(d)}this.uResolutionLocation=this.gl.getUniformLocation(this.shaderProgram,"u_resolution"),this.uProgressLocation=this.gl.getUniformLocation(this.shaderProgram,"u_progress");const l=this.gl.getUniformLocation(this.shaderProgram,"u_matrix"),p=()=>{const a=t[0];if(!a)throw new TypeError("failed to get image");const d=this.canvasRef.clientWidth/this.canvasRef.clientHeight;let g=a.width/a.height/d,_=1;g<1&&(_=1/g,g=1),this.gl.uniformMatrix4fv(l,!1,new Float32Array([g,0,0,0,0,-_,0,0,0,0,1,0,0,0,0,1]))};this.gl.uniform2fv(this.uResolutionLocation,[this.canvasRef.clientWidth,this.canvasRef.clientHeight]),this.gl.uniform1f(this.uProgressLocation,0),p();let u=t.length;for(let a=0;a<u;++a)this.gl.activeTexture(this.gl.TEXTURE0+a),this.gl.bindTexture(this.gl.TEXTURE_2D,n[a]);this.gl.activeTexture(this.gl.TEXTURE0+u),this.gl.bindTexture(this.gl.TEXTURE_2D,c),this.gl.uniform1i(this.uImage0Location,0),this.gl.uniform1i(this.uImage1Location,0),this.gl.uniform1i(this.uImageDisplaceLocation,u),this.gl.enableVertexAttribArray(e),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,i);let w=2,T=this.gl.FLOAT;this.gl.vertexAttribPointer(e,w,T,!1,0,0),this.gl.viewport(0,0,this.canvasRef.width,this.canvasRef.height),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6),new E(new R(this.canvasRef)).addListener("change",()=>{this.gl&&(this.setCanvasDim(),p(),this.gl.uniform2fv(this.uResolutionLocation,[this.canvasRef.clientWidth,this.canvasRef.clientHeight]),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.drawArrays(this.gl.TRIANGLES,0,6))})}render(){this.gl.uniform1f(this.uProgressLocation,this.transitionProgress),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}start(){this.transitionActive=!0,this.renderLoop&&cancelAnimationFrame(this.renderLoop),this.transitionForwards()}reverse(){this.transitionActive=!0,this.renderLoop&&cancelAnimationFrame(this.renderLoop),this.transitionBackwards()}transitionForwards(){this.transitionProgress<=1?(this.transitionProgress+=this.transitionTick,this.render(),this.renderLoop=requestAnimationFrame(()=>this.transitionForwards())):(this.transitionProgress=1,this.render(),this.transitionActive=!1,this.transitionFinished=!0)}transitionBackwards(){this.transitionProgress>=0?(this.transitionProgress-=this.transitionTick,this.render(),this.renderLoop=requestAnimationFrame(()=>this.transitionBackwards())):(this.transitionProgress=0,this.render(),this.transitionActive=!1,this.transitionFinished=!1)}setImage(t,s){this.gl.uniform1i(this.uImage0Location,t),this.gl.uniform1i(this.uImage1Location,s)}set progress(t){this.transitionProgress!==t&&(this.transitionProgress=t,this.gl.uniform1f(this.uProgressLocation,this.transitionProgress))}get progress(){return this.transitionProgress}draw(){this.gl.drawArrays(this.gl.TRIANGLES,0,6)}destroy(){this.gl&&(this.renderLoop&&cancelAnimationFrame(this.renderLoop),this.gl.deleteProgram(this.shaderProgram))}createShaderProgram(t,s,e){const i=this.createShader(t,t.VERTEX_SHADER,s),r=this.createShader(t,t.FRAGMENT_SHADER,e);return this.createProgram(t,i,r)}createShader(t,s,e){const i=t.createShader(s);if(!i)throw"could not create shader";if(t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;const n=t.getShaderInfoLog(i);throw t.deleteShader(i),`could not compile shader: ${n}`}createProgram(t,s,e){const i=t.createProgram();if(!i)throw"could not create program";if(t.attachShader(i,s),t.attachShader(i,e),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS))return i;const n=t.getProgramInfoLog(i);throw t.deleteProgram(i),`could not compile shader: ${n}`}}class A{element;canvas;details;dots;transition;constructor(t){let s=t.parentElement;this.canvas=s.querySelector(".transition"),this.element=t,this.transition=new P(this.canvas,["/imgs/summary/summary1.png","/imgs/summary/summary2.jpg","/imgs/summary/summary3.jpg"],"/imgs/summary/dis.jpg",{duration:1200}),this.details=[];for(let r of t.querySelectorAll(".summary-details"))this.details.push(r);this.dots=[];for(let r of s.querySelectorAll(".dots .dot"))this.dots.push(r);for(let r=0,n=this.dots.length;r<n;++r)this.dots[r].onclick=()=>{this.selected=r};t.querySelector(".control-arrow .left").addEventListener("click",()=>{let r=this.selected-1;r<0&&(r+=this.length),this.selected=r}),t.querySelector(".control-arrow .right").addEventListener("click",()=>{this.selected=(this.selected+1)%this.length}),this.selected=0}get length(){return this.details.length}_tween;_selected;set selected(t){if(this._selected!==t){typeof this._selected=="number"&&(this.dots[this._selected].classList.remove("selected"),this.details[this._selected].classList.remove("selected"));let s=this._selected||0;this._selected=t,this.dots[t].classList.add("selected"),this.details[t].classList.add("selected"),this.setTimeout(),this.transition.setImage(s,t),this.transition.progress=0,this.transition.draw(),this._tween?.stop(),this._tween=new v(this.transition).to({progress:1},900).onUpdate(()=>{this.transition.draw()}).start()}}get selected(){return this._selected}_timeout;setTimeout(){clearTimeout(this._timeout)}}for(let o of document.querySelectorAll(".summary"))new A(o);class x{element;milestones;constructor(t){this.element=t,t.addEventListener("mousedown",this.touchstart.bind(this)),t.addEventListener("touchstart",this.touchstart.bind(this)),t.addEventListener("mousemove",this.touchmove.bind(this)),t.addEventListener("touchmove",this.touchmove.bind(this)),window.addEventListener("mouseup",this.touchend.bind(this)),t.addEventListener("touchend",this.touchend.bind(this)),t.addEventListener("touchcancel",this.touchend.bind(this)),this.milestones=[];let s=!0,e=0;for(let i of this.element.querySelectorAll(".milestone")){let r=i;this.milestones.push(r),s&&r.classList.add("done"),r.classList.contains("selected")&&(s=!1,e=r.offsetLeft+r.clientWidth/2-this.element.clientWidth/2,this.element.scrollTo({left:e}))}}_dragging=!1;_pointer={x:0,y:0};_oldX;makePointer(t){t instanceof MouseEvent?this._pointer={x:t.screenX,y:t.screenY}:t instanceof TouchEvent&&(this._pointer={x:t.touches[0].screenX,y:t.touches[0].screenY})}touchstart(t){this._dragging||(this._dragging=!0,this.makePointer(t),this._oldX=this.element.scrollLeft)}touchmove(t){if(this._dragging){let s=this._pointer.x;this.makePointer(t);let e=s-this._pointer.x;if(e>0){let i=this.element.scrollWidth-this.element.clientWidth;this._oldX<i&&(this._oldX+=e),this._oldX>i&&(this._oldX=i),console.log(this._oldX),this.element.scrollTo({left:this._oldX})}else e<0&&(this._oldX>0&&(this._oldX+=e),this._oldX<0&&(this._oldX=0),this.element.scrollTo({left:this._oldX}))}}touchend(t){this._dragging&&(this._dragging=!1)}}for(let o of document.querySelectorAll(".road-map > .map"))new x(o);let S=document.querySelectorAll(".split-view");for(let o of S)new h(o);class I{element;volumeIcon;mute;video;muteIcon;volumeUpIcon;_firstPlay=!1;constructor(t){this.element=t,this.volumeIcon=t.querySelector(".volume-icon"),this.mute=localStorage.getItem("video-mute")==="1",this.video=t.querySelector(".video video"),this.muteIcon=t.querySelector(".mute"),this.volumeUpIcon=t.querySelector(".volume-up"),this.volumeIcon.onclick=()=>{this.mute=!this.mute,localStorage.setItem("video-mute",`${this.mute?1:0}`),this._updateVolumeIcon()},this._updateVolumeIcon(),this.playVideo(),window.addEventListener("mousedown",()=>{this.playVideo()});let s=()=>{let e=t.getBoundingClientRect(),i=(e.top+e.bottom)/2,r=window.innerHeight,n=Math.min(r/2-Math.abs(r/2-i),0),c=Math.max(1+n/2048,0);console.log(c),this.video.volume=c};window.addEventListener("scroll",s),s()}_updateVolumeIcon(){this.mute?(this.video.muted=!0,this.muteIcon.style.display="block",this.volumeUpIcon.style.display="none"):(this.video.muted=!1,this.muteIcon.style.display="none",this.volumeUpIcon.style.display="block")}async playVideo(){if(!this._firstPlay)try{await this.video.play(),this._firstPlay=!0}catch{}}}for(let o of document.querySelectorAll(".cover-gap"))new I(o);
